"use strict";(self.webpackChunkdm_frontend=self.webpackChunkdm_frontend||[]).push([[915],{915:(y,d,a)=>{a.r(d),a.d(d,{EdpmsReconModule:()=>O});var c=a(276),u=a(2579),m=a(2953),h=a(388),f=a(241),b=a(9408),x=a(5861),v=a(5963),S=a(2529),t=a(4650),C=a(4981),M=a(9670),E=a(6852),p=a(6895),l=a(4006),A=a(9182);function P(i,r){if(1&i&&(t.TgZ(0,"option",14),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function D(i,r){if(1&i&&(t.TgZ(0,"div",15)(1,"p",16),t._uU(2,"EDPMS Upload Progress"),t.qZA(),t.TgZ(3,"div",17),t._UZ(4,"span"),t.qZA()()),2&i){const e=t.oxw();t.xp6(4),t.Udp("width",e.width+"%")}}function k(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",18)(1,"button",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.compareEDPMS())}),t._uU(2,"Compare"),t.qZA()()}}let T=(()=>{class i{constructor(e,n,o,s){this.userService=e,this.appconfig=n,this.documentService=o,this.router=s,this.uploading=!1,this.uploaded=!1,this.documentType="",this.benneDetail=[],this.buyerDetail=[],this.width=0,this.bankAccounts=[],this.bankSelection="",this.disableUpload=!0,this.fileInputClick=g=>!!this.disableUpload||(g.preventDefault(),g.stopPropagation(),!1),this.api_base=n.apiUrl,this.loadFromLocalStorage(),this.headers={Authorization:this.authToken},this.config3={url:`${this.api_base}/documents/uploadFile3`,method:"POST",maxFiles:1,maxFilesize:5,addRemoveLinks:!0,headers:this.headers,timeout:82e4,dictDefaultMessage:"Drag a document here",acceptedFiles:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",previewTemplate:'<div  class="dz-preview dz-file-preview" style="text-align: right; margin-right:3px;">\n <div class="dz-image" style="text-align: right; margin-right:3px;"> <img data-dz-thumbnail /></div>\n <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <i style="color: red; text-align: center;font-size: 30px;" class="fa fa-exclamation-circle"></i>\n  </div>\n</div>'}}loadFromLocalStorage(){const e=localStorage.getItem("token");return this.authToken=e,this.authToken}getUserID(){var e=this;return(0,x.Z)(function*(){const n=yield e.userService.getUserDetail();e.applicant=n.result?.companyId})()}ngOnInit(){this.userService.getTeam().subscribe(e=>{this.masterTeam=e?.data[0]?.bankDetails,this.masterTeam.forEach(n=>this.bankAccounts.push(n?.bank)),console.log("banks:",this.bankAccounts)},e=>{console.log(e)}),this.getUserID(),this.documentService.getBlcopyref().subscribe(e=>{this.blMaster=e?.data},e=>{console.log(e)}),this.documentService.getAllExport("hhh").subscribe(e=>{this.tasksMaster=e?.data,console.log("tasksMaster:",this.tasksMaster)},e=>console.log(e)),this.documentService.getMaster(1).subscribe(e=>{this.masterSB=e?.data,console.log("getMaster:",e)},e=>{console.log(e)}),this.documentService.getPipo().subscribe(e=>{this.masterPIPO=e?.data,console.log("getPipo:",e)},e=>{console.log(e)}),this.documentService.getIrAdvice("").subscribe(e=>{this.masterIR=e?.data,console.log("getIrAdvice:",e)},e=>{console.log(e)})}chooseBank(){this.disableUpload=!this.bankSelection||""===this.bankSelection}saveData(){this.documentService.createEDPMS(this.preparePayload()).subscribe(e=>{console.log("create edpms res: ",e),this.router.navigateByUrl("/home/edpms-recon-table")},e=>{console.log("create EDPMS error: ",e)})}preparePayload(){let e=[];return this.masterExcelData.forEach(n=>{const o={userId:this.applicant,bank:this.bankSelection,sbNo:n["Shipping Bill No"],sbDate:new Date(24*(n["Shipping Bill Date"]-25569)*60*60*1e3),adCode:n["AD Code"],portCode:n["Port Code"],edpmsStatus:n.STATUS,adRefNo:n.adBillNo,sbAmount:n.sbAmount,sbBalanceAmount:this.getSBbalanceAmount(n.pipo,n.sbAmount),sbCurrency:n.sbCurrency,statusMeaning:this.getStatusMeaning(n.STATUS),systemStatus:this.getSystemStatus(n.systemStatus,n.pipo,n.sbAmount,n["Shipping Bill No"]),docAvailable:"Available"===n.systemStatus,action:this.getAction(n.systemStatus)};e.push(o)}),e}getSystemStatus(e,n,o,s){return"Available"!==e?"DOC NOT AVAILABLE IN SYSTEM":this.getSBbalanceAmount(n,o)>0?"PARTIALLY REALISED":this.checkIfBLDone(n)?"SUBMITTED & BANK REF NO. RECEIVED":this.checkifDownloaded(s)?"SUBMITTED BUT BANK REF NOT RECEIVED":"NOT SUBMITTED TO BANK"}checkifDownloaded(e){return!!this.tasksMaster?.some(n=>n?.task?.some(o=>o?.sbNumbers?.contains(e)))}checkIfBLDone(e){return!!this.blMaster.some(n=>n?.pipo?.contains(e))}getAction(e){let n=[];return"Available"!==e?n.push("Upload Documents"):n.push("Create Documents","Netoff/Setoff","ETX/Writeoff"),n}getSBbalanceAmount(e,n){let o=0;return this.masterIR.forEach(s=>{e===s?.pipo[0]&&(o+=parseInt(s?.amount,10))}),parseInt(n,10)-o}getStatusMeaning(e){return"PARTIALLY_PAID"===e?"Lodgement done but partially realised":"PENDING_AD_ACK"===e?"Lodgement not done":"PENDING_PAYMENT"===e?"Lodgement done":"EDPMS Status is not clear"}onUploadError(e){this.uploading=!1,console.log("onUploadError:",e,e[1].message)}onUploadInit(e){console.log("onUploadInit:",e)}onUploadSuccess(e){this.uploading=!1,this.uploaded=!0,console.log("onUploadSuccess ARGS",e),this.masterExcelData=e[1].data,console.log("onUploadSuccess DATA",this.masterExcelData)}compareEDPMS(){this.gatherSBdata(),this.saveData()}gatherSBdata(){this.masterExcelData.forEach((e,n)=>{var o=-1;for(let s=0;s<this.masterSB.length;s++)if(this.masterSB[s]&&this.masterSB[s].sbno&&this.masterSB[s].sbno==e["Shipping Bill No"]){o=s;break}console.log("index:",o),-1!==o?(this.masterExcelData[n].systemStatus="Available",this.masterExcelData[n].sbAmount=this.masterSB[o]?.fobValue,this.masterExcelData[n].sbCurrency=this.masterSB[o]?.fobCurrency,this.masterExcelData[n].adBillNo=this.masterSB[o]?.adBillNo,this.masterExcelData[n].pipo=this.masterSB[o]?.pipo[0]):this.masterExcelData[n].systemStatus="NOT_AVAILABLE"}),console.log("this.masterExcelData",this.masterExcelData)}submit(e){this.uploading=!0,console.log("submit: ",e),this.size=this.formatBytes(e[0].size),this.runProgressBar(e[0].size)}formatBytes(e){return e<1024?e+" Bytes":e<1048576?(e/1024).toFixed(3)+" KB":e<1073741824?(e/1048576).toFixed(3)+" MB":(e/1073741824).toFixed(3)+" GB"}runProgressBar(e){console.log(e/1500),(0,v.H)(0,e/2500).pipe((0,S.o)(()=>this.isWidthWithinLimit())).subscribe(()=>{this.width=this.width+1}),this.userService.getBene(1).subscribe(n=>{this.benneDetail=n.data},n=>console.log("Error",n)),this.userService.getBuyer(1).subscribe(n=>{this.buyerDetail=n.data},n=>console.log("Error",n))}isWidthWithinLimit(){return 100!==this.width}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(C.K),t.Y36(M.X),t.Y36(E.Z),t.Y36(c.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-edpms-recon"]],decls:25,vars:6,consts:[[1,"content-wrap",2,"margin-left","75px","margin-top","30px"],["id","content","role","main",1,"content","table-padding"],[1,"heading"],[2,"flex-direction","row","font-size","20px","margin-top","10px",";color","#303030"],[2,"display","flex","align-items","center",3,"ngModel","ngModelChange"],["value","","disabled","","hidden",""],["style","min-width:100%;",3,"value",4,"ngFor","ngForOf"],[1,"heading2"],["method","POST",1,"form"],["type","file","id","dropzone",1,"dropzone","dropzone-container",3,"dropzone","error","init","success","sending","click"],[1,"fas","fa-file-upload"],["type","submit"],["class","progressbar",4,"ngIf"],["style","text-align:center; margin-top: 20px",4,"ngIf"],[2,"min-width","100%",3,"value"],[1,"progressbar"],[1,"processheading"],[1,"meter"],[2,"text-align","center","margin-top","20px"],[3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"main",1)(2,"h3",2),t._uU(3,"New EDPMS Data"),t.qZA(),t.TgZ(4,"label",3),t._uU(5,"Select Bank*"),t.qZA(),t.TgZ(6,"select",4),t.NdJ("ngModelChange",function(s){return n.bankSelection=s})("ngModelChange",function(){return n.chooseBank()}),t.TgZ(7,"option",5),t._uU(8,"Select Bank"),t.qZA(),t.YNc(9,P,2,2,"option",6),t.qZA(),t.TgZ(10,"h3",7),t._uU(11,"Upload EDPMS Info"),t.qZA(),t.TgZ(12,"div",8)(13,"input",9),t.NdJ("error",function(s){return n.onUploadError(s)})("init",function(s){return n.onUploadInit(s)})("success",function(s){return n.onUploadSuccess(s)})("sending",function(s){return n.submit(s)})("click",function(s){return n.fileInputClick(s)}),t.qZA(),t._UZ(14,"i",10),t.TgZ(15,"h5"),t._uU(16,"Drag and Drop files here to upload"),t.qZA(),t.TgZ(17,"p"),t._uU(18,"Files Supported: XLSX"),t.qZA(),t.TgZ(19,"button",11),t._uU(20,"Choose File"),t.qZA(),t.TgZ(21,"p"),t._uU(22,"Maximum Size: 5MB"),t.qZA()(),t.YNc(23,D,5,2,"div",12),t.YNc(24,k,3,0,"div",13),t.qZA()()),2&e&&(t.xp6(6),t.Q6J("ngModel",n.bankSelection),t.xp6(3),t.Q6J("ngForOf",n.bankAccounts),t.xp6(4),t.Q6J("dropzone",n.config3),t.uIk("disabled",n.disableUpload?"":null),t.xp6(10),t.Q6J("ngIf",n.uploading),t.xp6(1),t.Q6J("ngIf",n.uploaded))},dependencies:[p.sg,p.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,A.uV],styles:['*[_ngcontent-%COMP%]{font-family:EuropaNuova-Regular,sans-serif!important;background-color:#fff}.heading[_ngcontent-%COMP%]{font-family:EuropaNuova-Regular,sans-serif!important;font-size:20px;font-weight:400;color:#323e4a;padding-bottom:10px!important;margin-bottom:5px!important;border-bottom:1px solid #eaedf3}.content-wrap[_ngcontent-%COMP%]{margin-left:300px;margin-top:100px}.customDropdown[_ngcontent-%COMP%]{display:inline-block;font-size:14px;padding-left:12px;padding-right:10px;height:24px;border-radius:2px;border:1px solid black;cursor:pointer;z-index:1}.customDropdown[_ngcontent-%COMP%]{position:relative;display:inline-block;font-size:14px;padding-left:12px;padding-right:10px;height:24px;border-radius:2px;border:1px solid black;margin-right:12px;cursor:pointer;z-index:1}.customDropdown[_ngcontent-%COMP%]:hover{color:#4b74ff!important}.dropdown-content[_ngcontent-%COMP%]{display:none;border:.01em solid black;background:white;transform:translate(-14px,-1px);box-shadow:0 4px 8px #0003;transition:.3s}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;padding:0 6px;color:#000;height:24px}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#49a2d7;color:#fff}.customDropdown[_ngcontent-%COMP%]   .dropIco[_ngcontent-%COMP%]{margin-left:7px}.dropdown-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.customDropdown[_ngcontent-%COMP%]:hover   .dropdown-content[_ngcontent-%COMP%]{display:block}.fas[_ngcontent-%COMP%]{font-family:"Font Awesome 5 Free"!important}.heading2[_ngcontent-%COMP%]{font-family:EuropaNuova-Regular,sans-serif!important;font-size:20px;font-weight:400;color:#323e4a;padding-bottom:10px!important;margin-bottom:5px!important;margin-top:30px}.form[_ngcontent-%COMP%]{margin-top:15px;margin-right:5%;top:50%;left:50%;width:82%;height:300px;background-color:#fff;border:2px dashed rgba(0,0,0,.2);display:flex;flex-direction:column;align-items:center;padding-top:2%}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:EuropaNuova-Regular,sans-serif!important;position:absolute;margin:0;width:75%;height:221px;padding:0;outline:none;opacity:0}.form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Poppins,sans-serif!important;font-weight:400;border:none;height:52px;width:160px;background-color:#ebebeb;padding-top:1%;padding-bottom:1%;border-radius:6px;color:#0009;outline:none;margin-bottom:2px}.form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#149174;color:#0c5645}.form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{border:0}.form[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:35px;color:#0003;margin-bottom:2%}.meter[_ngcontent-%COMP%]{margin-left:35px;width:80%;height:4px;position:relative;background:#d8d8d8;border-radius:25px;box-shadow:inset 0 -1px 1px #ffffff4d}.meter[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:block;height:100%;border-radius:20px;background-color:#2992fc;background-image:linear-gradient(center bottom,rgb(43,194,83) 37%,rgb(84,240,84) 69%);box-shadow:inset 0 2px 9px #ffffff4d,inset 0 -2px 6px #0006;position:relative;overflow:hidden}.progressbar[_ngcontent-%COMP%]{height:53px;margin-top:60px}.processheading[_ngcontent-%COMP%]{padding-left:30px}']}),i})(),O=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[u.D,m.FF,f.g],imports:[b.$,c.Bz.forChild([{path:"",component:T,pathMatch:"full"}]),h.zk.forRoot()]}),i})()}}]);